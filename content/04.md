#Advanced File I/O
##Scatter/Gather I/O
Scatter/gather I/O is a method of input and output where a single system call writes to a vector of buffers from a single data stream, or, alternatively, reads into a vector of buffers from a single data stream. An alternative name for this approach to input and output is vectored I/O. In comparison, the standard read and write system calls provide linear I/O.

Scatter/gather I/O provides serveral advantages over linear I/O methods:

- More natural coding pattern: If your data is naturally segmented--say, the fields of a predefined structure--vectored I/O allows for intuitive manipulation.
- Efficiency: A single vectored I/O operation can replace multiple linear I/O operations.
- Performance: In addition to a reduction in the number of issued system calls, a vectored I/O implementation can provide improved performance over a linear I/O implementation via internal optimizations.
- Atomicity: In contrast with multiple linear I/O operations, a process can execute a single vectored I/O operation with no risk of interleaving I/O from another process.

###readv() and writev()
```C
#include <sys/uio.h>

struct iovec {
	void *iov_base;		/* pointer to start of buffer */
	size_t iov_len;		/* size of buffer in bytes */
};

// reads count segments from the fd into iov
ssize_t readv(int fd,
			  const struct iovec *iov,
			  int count);

// writes at most count segments from the buffers
// described by iov into fd
ssize_t writev(int fd,
			   const struct iovec *iov,
			   int count);
```
On success, `readv()` and `writev()` return the number of bytes read or written, respectively. This number should be the sum of all count iov_len values. On error, the system calls return -1 and set errno as appropriate.

####writev() example
```C
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <string.h>
#include <sys/uio.h>

int main()
{
	struct iovec iov[3];
	ssize_t nr;
	int fd, i;

	char *buf[] = {
			"The term buccaneer comes from the word boucan.\n",
			"A boucan is a wooden frame used for cooking meat.\n",
			"Buccaneer is the West Indies name for a pirate.\n" };

	fd = open("buccaneer.txt", O_WRONLY|O_CREAT|O_TRUNC);
	if (fd == -1) {
		perror("open");
		return 1;
	}

	/* fill out three iovec structures */
	for (i = 0; i < 3; i++) {
		iov[i].iov_base = buf[i];
		iov[i].iov_len = strlen(buf[i])+1;
	}
	/* with a single call, write them all out */
	nr = writev(fd, iov, 3);
	if (nr == -1) {
		perror("writev");
		return 1;
	}
	printf("wrote %d bytes\n", nr);

	if (close(fd)) {
		perror("close");
		return 1;
	}
	
	return 0;
}
```
####readv() example
```C
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sys/uio.h>

int main()
{
	char foo[48], bar[51], baz[49];
	struct iovec iov[3];
	ssize_t nr;
	int fd, i;

	fd = open("buccaneer.txt", O_RDONLY);
	if (fd == -1) {
		perror("open");
		return 1;
	}
	
	/* set up our iovec structures */
	iov[0].iov_base = foo;
	iov[0].iov_len = sizeof(foo);
	iov[1].iov_base = bar;
	iov[1].iov_len = sizeof(bar);
	iov[2].iov_base = baz;
	iov[2].iov_len = sizeof(baz);

	/* read into the structures with a single call */
	nr = readv(fd, iov, 3);
	if (nr == -1) {
		perror("readv");
		return 1;
	}
	
	for (i = 0; i < 3; i++)
		printf("%d: %s", i, (char*)iov[i].iov_base);

	if (close(fd)) {
		perror("close");
		return 1;
	}

	return 0;
}
```
##Event Poll

##Mapping Files into Memory
##Advice for Normal File I/O
##Synchronized, Synchronous, and Asynchoronous Operations
##I/O Schedulers and I/O Performance